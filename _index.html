<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Predix UI</title>
    <script src="bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>
    <link rel="icon" href="img/favicon.ico" type="image/x-icon" />
    <link rel="import" href="css/predix-ui-styles.html" />
    <style include="predix-ui-styles" is="custom-style"></style>
    <link rel="import" href="bower_components/px-theme/px-theme-styles.html" />
    <style include="px-theme-styles" is="custom-style"></style>
    <link rel="import" href="bower_components/iron-collapse/iron-collapse.html" />
    <link rel="import" href="bower_components/polymer-font-awesome/polymer-font-awesome.html" />
    <link rel="import" href="bower_components/px-spinner/px-spinner.html" />
    <link rel="import" href="px-sb.html" />
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-80996379-1', 'auto');
    ga('send', 'pageview');
    </script>
    <style>
    html{
      font-size: 15px;
    }
    #spinner{position:absolute;z-index:999;width:100%;height:100%;background:#fff;}
    #spinner px-spinner {margin:25% 36%;vertical-align: middle;}
    </style>
  </head>
  <body unresolved>
    <template id="px-catalog-wrapper" is="dom-bind">
      <!-- header -->
      <section class="gray-bar flex flex--middle">
        <span id="menu" class="menu">
          <iron-icon id="menu__open-icon" class="menu__open-icon" icon="fa:fa-bars"></iron-icon>
          <iron-icon id="menu__close-icon" class="menu__close-icon is__hidden" icon="fa:fa-times"></iron-icon>
        </span>
        <div class="lnk first">
          <a class="header-lnk" href="http://predix.io" target="_blank">
            <img class="header-img" src="img/Predix_small.png" alt="Predix Logo"/> Developer Network
          </a>
        </div>
      </section>

      <!-- overlay -->
      <div id="overlay" class="overlay"></div>
      <div class="wrapper-flex">
        <!-- side nav -->
        <div id="side-nav" class="side-nav side-nav__default">
            <px-sb></px-sb>
        </div>

        <!-- iframe -->
        <div class="iframe__container">
          <div id="spinner">
            <px-spinner size="100"></px-spinner>
          </div>
          <iframe src="{{iframeUrl}}" allowfullscreen name="iframe_a" class="iframe" id="iframe_a">
            <p>Your browser does not support iframes.</p>
          </iframe>
        </div>
      </div>
    </template>

    <script type="text/javascript">
      /**
      * Setup the functions and values for the catalog wrapper application,
      * which manages state based on URL parameters and updates the iFrame
      */
      var template = document.querySelector('template[is=dom-bind]'),

      /**
      * Reads through the sidebar links and fetched the frames we want to
      * preload so they can be passed into px-frames.
      */
      // getPreloadFrames = function() {
      //   var _this = this,
      //       links = document.getElementsByClassName("nav-lnk"),
      //       preloadFrames = [];
      //
      //   Array.prototype.forEach.call(links, function(link) {
      //     if (link.dataset && link.dataset.preload) {
      //       preloadFrames.push(getWantedFrame(link.dataset.name || null, link.dataset.type || null));
      //     }
      //   });
      //
      //   this.preloadFrames = preloadFrames;
      // },

      /**
      * Toggles the menu on mobile
      */
      toggleNavClasses = function() {
        document.getElementById("side-nav").classList.toggle('side-nav__default');
        document.getElementById("overlay").classList.toggle('overlay--visible');
        document.getElementById("menu__open-icon").classList.toggle('is__hidden');
        document.getElementById("menu__close-icon").classList.toggle('is__hidden');
      },

      /**
      * Shows the spinner
      */
      showSpinner = function() {
        document.getElementById('spinner').classList.remove('is__hidden');
        this.spinnerIsActive = true;
      },

      /**
      * Hides the spinner
      */
      hideSpinner = function() {
        document.getElementById('spinner').classList.add('is__hidden');
        this.spinnerIsActive = false;
      };

      window.addEventListener('px-sb-list-iframe-url-change', function(e) {
        console.log(e);
        if (e.detail.external) {
          template.iframeUrl = 'external_links.html';
          console.log(template.iframeUrl);
        } else {
          template.iframeUrl = e.detail.url;  
        }

      });

      // Assign functions
      //template.getPreloadFrames = getPreloadFrames;
      template.toggleNavClasses = toggleNavClasses;
      template.showSpinner = showSpinner;
      template.hideSpinner = hideSpinner;
      template.iframeUrl = '';

      // Assign variables
      this.iframeUrl = null;
      this.spinnerIsActive = true;

      document.addEventListener("WebComponentsReady", function(e){
        // Get DOM elements we'll manipulate
        template.iframe = document.getElementById('iframe_a');
        template.spinner = document.getElementById('spinner');
        template.menu = document.getElementById("menu");
        template.overlay = document.getElementById("overlay");

        // The spinner is active by default. When the iFrame loads, hide it.
        template.iframe.addEventListener("load", function(){
          this.hideSpinner();
        }.bind(template));

        template.menu.addEventListener("click", function(){
          this.toggleNavClasses();
          this.hideSpinner();
        }.bind(template));

        template.overlay.addEventListener("click", function(){
          this.toggleNavClasses();
        }.bind(template));

      //  template.getRoute();
      });

    </script>
  </body>
</html>
