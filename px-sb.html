<!--
    Relative paths assume component is being run from inside an app or another component, where dependencies are flat
    siblings. When this component is run from its own repo (e.g. ui tests, examples), we assume the server is started with
    'grunt depserve' (or similar server setup) to enable correct finding of bower dependencies for local runs
-->
<link rel="import" href="bower_components/polymer/polymer.html" />
<link rel="import" href="px-sb-list.html" />
<!--
Element providing sidebar for the predix ui website.

##### Usage

```

```

@element px-sb
@blurb Element providing sidebar for the predix ui website.
@homepage index.html
@demo demo.html
-->
<link rel="import" href="css/px-sb-styles.html">

<dom-module id="px-sb">
  <template>
    <style include="px-sb-styles"></style>
    <style include="px-theme-styles"></style>
    <ul>
      <template is="dom-repeat" items="[[nav]]">
        <px-sb-list nav-item="[[item]]" selected="{{selected}}"></px-sb-list>
      </template>
    </ul>
  </template>
</dom-module>
<script>
  Polymer({
    is: 'px-sb',
    _clearOpened: function(navArr) {
      var len = navArr.length,
          i,
          foundItem;

      //else, loop through the sub-items recursively
      for (i = 0; i < len; i++) {
        if (navArr[i].links) {
          this._clearOpened(navArr[i]);
        }
        //check if this item has the search query in the text. Since we made sure that query isn't false, we'd never reach this stage without query being true.
        if (navArr[i].opened) {
          navArr[i].opened = false;
        }
        if (navArr[i].selected) {
          navArr[i].selected = false;
        }
      }
    },
    _findSelectedItemTrail: function(navArr, selectedItemEvt) {
      var foundItem,
          openedItemsArr = [],
          selectedItem = selectedItemEvt.detail.selectedItem;


      for (var i = 0, len = navArr.length; i < len; i++) {
        if (navArr[i].links) {
          var arr = this._findSelectedItemTrail(navArr[i].links, selectedItemEvt);
          if (arr !== null) {
            arr.push(navArr[i]);
            return arr;
          }
        }

        if (navArr[i].repoName === selectedItem) {
          navArr[i].selected = true;
          return [navArr[i]];
        }
      }
      return null;
    },
    _findInitialSelected: function() {
      var pxSb = document.querySelector('px-sb'),
          pxSbLists = Polymer.dom(pxSb.root).querySelectorAll('px-sb-list'),
          selected;

          pxSbLists.forEach(function(pxSbList) {
            selected = Polymer.dom(pxSbList.root).querySelector('.selected');

            if (selected) {
              this.set('selected', selected);
            }
          }.bind(this));
    },
    changeOpenedProperty: function(trail) {
      trail.forEach(function(item) {
        item.opened = true;
      });
    },
    _changeOpenMenus: function(selectedItem) {
      this._clearOpened(this.nav);
      var trail = this._findSelectedItemTrail(this.nav, selectedItem);
      trail.splice(0,1); //remove the item itself, only keep the parents
      this.changeOpenedProperty(trail);
      this._findInitialSelected();
    },
    listeners: {
      'px-sb-list-selected-item-changed' : '_changeOpenMenus'
    },
    properties: {
      openedItemsArr: {
        type: Array,
        value: function() {return[];}
      },
      selected: {
        type: Object,
        notify: true
      },
      opened: {
        type: Array,
        value: function(){return [];}
      },
      nav: {
        type: Array,
        notify: true,
        value: [{
            "linkText": "Home",
            "repoName": "landing_page",
            "dataType": "home",
          },
          {
            "linkText": "Getting Started",
            "links": [{
                "dataType": "local",
                "repoName": "getting_started",
                "linkText": "Using Predix UI Components"
            }, {
                "dataType": "external",
                "repoName": "px-getting-started",
                "linkText": "Predix UI CSS Overview"
            }, {
                "dataType": "external",
                "repoName": "generator-px-comp",
                "linkText": "Creating a New Component"
            }, {
                "dataType": "external",
                "repoName": "px-starter-kit-design",
                "linkText": "Bootstrapping Predix UI CSS"
            }],
            "opened": true
          },
          {
            "linkText": "Predix UI CSS",
            "links": [{
                "linkText": "Visual",
                "links": [{
                    "repoName": "px-actionable-text-icons-design",
                    "dataType": "external",
                    "linkText": "Actionable Text & Icons"
                    }, {
                    "linkText": "Buttons",
                      "links": [{
                          "repoName": "px-meta-buttons-design",
                          "dataType": "external",
                          "linkText": "Buttons (Meta)"
                          }, {
                          "repoName": "px-button-group-design",
                          "dataType": "external",
                          "linkText": "Button Group"
                          }, {
                          "repoName": "px-buttons-design",
                          "dataType": "external",
                          "linkText": "Buttons"
                          }]
                        }, {
                        "repoName": "px-code-design",
                        "dataType": "external",
                        "linkText": "Code"
                        }, {
                        "repoName": "px-forms-design",
                        "dataType": "external",
                        "linkText": "Forms"
                        }, {
                        "repoName": "px-headings-design",
                        "dataType": "external",
                        "linkText": "Headings"
                        }, {
                        "repoName": "px-helpers-design",
                        "dataType": "external",
                        "linkText": "Helpers"
                        }, {
                        "repoName": "px-input-group-design",
                        "dataType": "external",
                        "linkText": "Input Group"
                        }, {
                        "repoName": "px-layout-design",
                        "dataType": "external",
                        "linkText": "Layout"
                        }, {
                        "linkText": "Lists",
                          "links": [{
                          "repoName": "px-meta-lists-design",
                          "dataType": "external",
                          "linkText": "Lists (Meta)"
                          }, {
                          "repoName": "px-list-bare-design",
                          "dataType": "external",
                          "linkText": "List Bare"
                          }, {
                          "repoName": "px-list-inline-design",
                          "dataType": "external",
                          "linkText": "List Inline"
                          }, {
                          "repoName": "px-list-ui-design",
                          "dataType": "external",
                          "linkText": "List UI"
                          }]
                        }, {
                        "repoName": "px-tables-design",
                        "dataType": "external",
                        "linkText": "Tables"
                        }, {
                        "repoName": "px-toggle-design",
                        "dataType": "external",
                        "linkText": "Toggle"
                    }]
                  },
                  {
                "linkText": "Layout",
                  "links": [{
                    "repoName": "px-box-design",
                    "dataType": "external",
                    "linkText": "Box"
                    }, {
                    "repoName": "px-flag-design",
                    "dataType": "external",
                    "linkText": "Flag"
                    }, {
                    "repoName": "px-flexbox-design",
                    "dataType": "external",
                    "linkText": "Flexbox"
                    }, {
                    "repoName": "px-layout-design",
                    "dataType": "external",
                    "linkText": "Layout"
                    }, {
                    "repoName": "px-spacing-design",
                    "dataType": "external",
                    "linkText": "Spacing"
                    }, {
                    "repoName": "px-widths-design",
                    "dataType": "external",
                    "linkText": "Widths"
                    }, {
                    "repoName": "px-width-tools-design",
                    "dataType": "external",
                    "linkText": "Width Tools"
                    }]
                  },
                  {
                "linkText": "Utilities",
                  "links": [{
                    "repoName": "px-box-sizing-design",
                    "dataType": "external",
                    "linkText": "Box Sizing"
                    }, {
                    "repoName": "px-clearfix-design",
                    "dataType": "external",
                    "linkText": "Clearfix"
                    }, {
                    "repoName": "px-defaults-design",
                    "dataType": "external",
                    "linkText": "Defaults"
                    }, {
                    "repoName": "px-functions-design",
                    "dataType": "external",
                    "linkText": "Functions"
                    }, {
                    "repoName": "px-helpers-design",
                    "dataType": "external",
                    "linkText": "Helpers"
                    }, {
                    "repoName": "px-iconography-design",
                    "dataType": "external",
                    "linkText": "iconography"
                    }, {
                    "repoName": "px-mixins-design",
                    "dataType": "external",
                    "linkText": "mixins"
                    }, {
                    "repoName": "px-normalize-design",
                    "dataType": "external",
                    "linkText": "Normalize"
                    }, {
                    "repoName": "px-typography-design",
                    "dataType": "external",
                    "linkText": "Typography"
                    }, {
                    "repoName": "px-viewport-design",
                    "dataType": "external",
                    "linkText": "Viewport"
                  }]
                }
              ]
            },
            {
            "linkText": "Predix UI Components",
            "links": [{
                "repoName": "px-alert-label",
                "dataType": "component",
                "linkText": "Alert Label"
                }, {
                "repoName": "px-alert-message",
                "dataType": "component",
                "linkText": "Alert Message"
                }, {
                "repoName": "px-app-nav",
                "dataType": "component",
                "linkText": "App Nav"
                }, {
                "linkText": "Cards",
                "links": [{
                    "repoName": "px-card",
                    "dataType": "component",
                    "linkText": "Card"
                    }, {
                    "repoName": "px-deck-selector",
                    "dataType": "component",
                    "linkText": "Deck Selector"
                    }, {
                    "repoName": "px-sample-cards",
                    "dataType": "component",
                    "linkText": "Sample Cards"
                    }, {
                    "repoName": "px-widget-cards",
                    "dataType": "component",
                    "linkText": "Widget Cards"
                }]
            }, {
                "linkText": "Charts",
                "links": [
                  {
                    "repoName": "px-percent-circle",
                    "dataType": "component",
                    "linkText": "Percent Circle"
                    }, {
                    "repoName": "px-simple-bar-chart",
                    "dataType": "component",
                    "linkText": "Simple Bar Chart"
                    }, {
                    "repoName": "px-simple-horizontal-bar-chart",
                    "dataType": "component",
                    "linkText": "Simple horizontal Bar Chart"
                    }, {
                    "repoName": "px-simple-line-chart",
                    "dataType": "component",
                    "linkText": "Simple Line Chart"
                    }, {
                    "repoName": "px-chart",
                    "dataType": "component",
                    "linkText": "Chart"
                    }, {
                    "repoName": "px-vis",
                    "dataType": "component",
                    "linkText": "Vis Framwork"
                    }, {
                    "repoName": "px-vis-pie-chart",
                    "dataType": "component",
                    "linkText": "Vis Pie Chart"
                    }, {
                    "repoName": "px-vis-timeseries",
                    "dataType": "component",
                    "linkText": "Vis Timeseries"
                    }, {
                    "repoName": "px-vis-xy-chart",
                    "dataType": "component",
                    "linkText": "Vis XY Chart"
                }]

                }, {
                "repoName": "px-clipboard",
                "dataType": "component",
                "linkText": "Clipboard"
                }, {
                "repoName": "px-context-browser",
                "dataType": "component",
                "linkText": "Context Browser"
                }, {
                "repoName": "px-data-table",
                "dataType": "component",
                "linkText": "Data Table"
                }, {
                "linkText": "Datetime Components",
                "links": [{
                    "repoName": "px-calendar-picker",
                    "dataType": "component",
                    "linkText": "Calendar Picker"
                    }, {
                    "repoName": "px-simple-bar-chart",
                    "dataType": "component",
                    "linkText": "Simple Bar Chart"
                    }, {
                    "repoName": "px-simple-horizontal-bar-chart",
                    "dataType": "component",
                    "linkText": "Simple horizontal Bar Chart"
                    }, {
                    "repoName": "px-simple-line-chart",
                    "dataType": "component",
                    "linkText": "Simple Line Chart"
                    }, {
                    "repoName": "px-chart",
                    "dataType": "component",
                    "linkText": "Chart"
                    }, {
                    "repoName": "px-vis",
                    "dataType": "component",
                    "linkText": "Vis Framwork"
                }]
                }, {
                "repoName": "px-dropdown",
                "dataType": "component",
                "linkText": "Dropdown"
                }, {
                "repoName": "px-file-upload",
                "dataType": "component",
                "linkText": "File Upload"
                }, {
                "repoName": "polymer-font-awesome",
                "dataType": "component",
                "linkText": "Font Awesome"
                }, {
                "repoName": "px-login",
                "dataType": "component",
                "linkText": "Login"
                }, {
                "repoName": "px-modal",
                "dataType": "component",
                "linkText": "Modal"
                }, {
                "repoName": "px-overlay",
                "dataType": "component",
                "linkText": "Overlay"
                }, {
                "repoName": "px-popover",
                "dataType": "component",
                "linkText": "Popover"
                }, {
                "repoName": "px-progress-bar",
                "dataType": "component",
                "linkText": "Progress Bar"
                }, {
                "repoName": "px-slider",
                "dataType": "component",
                "linkText": "Slider"
                }, {
                "repoName": "px-spinner",
                "dataType": "component",
                "linkText": "Spinner"
                }, {
                "repoName": "px-tabs",
                "dataType": "component",
                "linkText": "Tabs"
                }, {
                "repoName": "px-tooltip",
                "dataType": "component",
                "linkText": "Tooltip"
                }, {
                "repoName": "px-validation",
                "dataType": "component",
                "linkText": "Validation"
            }]
        }]
      }
    }
  });
</script>
